{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "service-api-arch",
  "description": "service-api-arch",
  "type": "object",
  "required": [],
  "properties": {
    "project_name": {
      "description": "The identifier of this application",
      "type": "string"
    },
    "namespace": {
      "description": "Dot separated identifier which is typically used for identifier of modules",
      "type": "string"
    },
    "project_title": {
      "description": "The title of this project",
      "type": "string"
    },
    "datasources": {
      "description": "datasource",
      "type": "array",
      "items": {
        "$ref": "#/definitions/entities/datasource"
      }
    },
    "services": {
      "description": "service",
      "type": "array",
      "items": {
        "$ref": "#/definitions/entities/service"
      }
    },
    "rest_resources": {
      "description": "rest_resource",
      "type": "array",
      "items": {
        "$ref": "#/definitions/entities/rest_resource"
      }
    },
    "data_accesses": {
      "description": "data_access",
      "type": "array",
      "items": {
        "$ref": "#/definitions/entities/data_access"
      }
    },
    "entities": {
      "description": "エンティティ",
      "type": "array",
      "items": {
        "$ref": "#/definitions/entities/entity"
      }
    },
    "value_domain_types": {
      "description": "value_domain_type",
      "type": "array",
      "items": {
        "$ref": "#/definitions/entities/value_domain_type"
      }
    }
  },
  "definitions": {
    "value_domain_types": {
      "http_method_for_rest": {
        "description": "http_method_for_rest",
        "enum":[
           "GET",
           "POST",
           "PUT",
           "PATCH",
           "DELETE"
        ],
        "type": "string"
      },
      "url_path_with_placeholders": {
        "description": "url_path_with_placeholders",
        "pattern": "^(/[-$_a-zA-Z0-9]*|/\\{[_$a-zA-Z][_$a-zA-Z0-9]*\\})+$",
        "type": "string"
      },
      "identifier": {
        "description": "主要言語で識別子として使用可能な文字列",
        "pattern": "^[_$a-zA-Z][_$a-zA-Z0-9]*$",
        "type": "string"
      },
      "namespace": {
        "description": "名前空間",
        "pattern": "^[_a-zA-Z][_$a-zA-Z0-9]*(\\.[_a-zA-Z][_$a-zA-Z0-9]*)*$",
        "type": "string"
      },
      "base_type": {
        "description": "基本型",
        "enum":[
           "string",
           "boolean",
           "number"
        ],
        "type": "string"
      }
    },
    "entities": {
      "datasource": {
        "description": "datasource",
        "type": "object",
        "required": [
          "name",
          "type",
          "user"
        ],
        "properties": {
          "name": {
            "description": "The name of this datasource.",
            "type": "string"
          },
          "type": {
            "description": "The type of this datasource.",
            "enum":[
              "postgres"
            ],
            "type": "string"
          },
          "identifier": {
            "allOf": [{
            "description": "The identifier of this datasource.",
            "type": "string"
            }, {
            "$ref": "#/definitions/value_domain_types/identifier"
            }]
          },
          "description": {
            "description": "The description of this datasource.",
            "type": "string"
          },
          "hostname": {
            "description": "The hostname of this datasource.",
            "type": "string"
          },
          "port": {
            "description": "The port of this datasource.",
            "type": "number"
          },
          "jdbc_url": {
            "description": "The jdbc_url of this datasource.",
            "type": "string"
          },
          "dbname": {
            "description": "The dbname of this datasource.",
            "type": "string"
          },
          "user": {
            "description": "The user of this datasource.",
            "type": "string"
          },
          "password": {
            "description": "The password of this datasource.",
            "type": "string"
          },
          "container_name": {
            "description": "The container_name of this datasource.",
            "type": "string"
          },
          "container_image": {
            "description": "The container_image of this datasource.",
            "type": "string"
          },
          "entity_references": {
            "description": "entity_references",
            "type": "array",
            "items": {
              "$ref": "#/definitions/entities/entity_reference"
            }
          }
        }
      },
      "entity_reference": {
        "description": "entity_reference",
        "type": "object",
        "required": [
          "entity_name"
        ],
        "properties": {
          "entity_name": {
            "description": "The entity_name of this entity_reference.",
            "type": "string"
          }
        }
      },
      "rest_data_item": {
        "description": "rest_data_item",
        "type": "object",
        "required": [
          "name"
        ],
        "properties": {
          "name": {
            "description": "The name of this rest_data_item.",
            "type": "string"
          },
          "identifier": {
            "description": "The identifier of this rest_data_item.",
            "type": "string"
          },
          "type": {
            "allOf": [{
            "description": "The type of this rest_data_item.",
            "type": "string"
            }, {
            "$ref": "#/definitions/value_domain_types/base_type"
            }]
          },
          "entity_name": {
            "description": "The entity_name of this rest_data_item.",
            "type": "string"
          },
          "description": {
            "description": "The description of this rest_data_item.",
            "type": "string"
          },
          "root": {
            "description": "Defines this rest_data_item is root or not.",
            "type": "boolean"
          },
          "multiple": {
            "description": "Defines this rest_data_item is multiple or not.",
            "type": "boolean"
          },
          "required": {
            "description": "Defines this rest_data_item is required or not.",
            "type": "boolean"
          },
          "default_value": {
            "description": "The default_value of this rest_data_item.",
            "type": "string"
          },
          "example_value": {
            "description": "The example_value of this rest_data_item.",
            "type": "string"
          },
          "children": {
            "description": "children",
            "type": "array",
            "items": {
              "$ref": "#/definitions/entities/rest_data_item"
            }
          }
        }
      },
      "graphql_query": {
        "description": "graphql_query",
        "type": "object",
        "required": [
          "name",
          "query"
        ],
        "properties": {
          "name": {
            "description": "The name of this graphql_query.",
            "type": "string"
          },
          "identifier": {
            "description": "The identifier of this graphql_query.",
            "type": "string"
          },
          "description": {
            "description": "The description of this graphql_query.",
            "type": "string"
          },
          "query": {
            "description": "The query of this graphql_query.",
            "type": "string"
          },
          "multiple": {
            "description": "Defines this graphql_query is multiple or not.",
            "type": "boolean"
          },
          "record_entity_name": {
            "description": "The record_entity_name of this graphql_query.",
            "type": "string"
          },
          "record_type": {
            "allOf": [{
            "description": "The record_type of this graphql_query.",
            "type": "string"
            }, {
            "$ref": "#/definitions/value_domain_types/base_type"
            }]
          },
          "return_type": {
            "description": "The return_type of this graphql_query.",
            "type": "string"
          }
        }
      },
      "rest_operation": {
        "description": "rest_operation",
        "type": "object",
        "required": [
          "method",
          "namespace"
        ],
        "properties": {
          "method": {
            "allOf": [{
            "description": "The method of this rest_operation.",
            "type": "string"
            }, {
            "$ref": "#/definitions/value_domain_types/http_method_for_rest"
            }]
          },
          "path": {
            "allOf": [{
            "description": "The path of this rest_operation.",
            "type": "string"
            }, {
            "$ref": "#/definitions/value_domain_types/url_path_with_placeholders"
            }]
          },
          "name": {
            "description": "The name of this rest_operation.",
            "type": "string"
          },
          "identifier": {
            "description": "The identifier of this rest_operation.",
            "type": "string"
          },
          "namespace": {
            "allOf": [{
            "description": "The namespace of this rest_operation.",
            "type": "string"
            }, {
            "$ref": "#/definitions/value_domain_types/namespace"
            }]
          },
          "description": {
            "description": "The description of this rest_operation.",
            "type": "string"
          },
          "path_parameters": {
            "description": "path_parameters",
            "type": "array",
            "items": {
              "$ref": "#/definitions/entities/rest_data_item"
            }
          },
          "request_headers": {
            "description": "request_headers",
            "type": "array",
            "items": {
              "$ref": "#/definitions/entities/rest_data_item"
            }
          },
          "query_parameters": {
            "description": "query_parameters",
            "type": "array",
            "items": {
              "$ref": "#/definitions/entities/rest_data_item"
            }
          },
          "request_body": {
            "description": "request_body",
            "type": "array",
            "items": {
              "$ref": "#/definitions/entities/rest_data_item"
            }
          },
          "response_headers": {
            "description": "response_headers",
            "type": "array",
            "items": {
              "$ref": "#/definitions/entities/rest_data_item"
            }
          },
          "response_body": {
            "description": "response_body",
            "type": "array",
            "items": {
              "$ref": "#/definitions/entities/rest_data_item"
            }
          }
        }
      },
      "service": {
        "description": "service",
        "type": "object",
        "required": [
          "name",
          "version",
          "datasource_name"
        ],
        "properties": {
          "name": {
            "description": "The name of this service.",
            "type": "string"
          },
          "identifier": {
            "allOf": [{
            "description": "The identifier of this service.",
            "type": "string"
            }, {
            "$ref": "#/definitions/value_domain_types/identifier"
            }]
          },
          "version": {
            "description": "The version of this service.",
            "type": "string"
          },
          "api_version": {
            "description": "The api_version of this service.",
            "type": "string"
          },
          "endpoint": {
            "description": "The endpoint of this service.",
            "type": "string"
          },
          "host": {
            "description": "The host of this service.",
            "type": "string"
          },
          "port": {
            "description": "The port of this service.",
            "type": "number"
          },
          "protocol": {
            "description": "The protocol of this service.",
            "enum":[
              "http",
              "https"
            ],
            "type": "string"
          },
          "path": {
            "description": "The path of this service.",
            "type": "string"
          },
          "namespace": {
            "allOf": [{
            "description": "The namespace of this service.",
            "type": "string"
            }, {
            "$ref": "#/definitions/value_domain_types/namespace"
            }]
          },
          "description": {
            "description": "The description of this service.",
            "type": "string"
          },
          "datasource_name": {
            "description": "The datasource_name of this service.",
            "type": "string"
          },
          "resource_entries": {
            "description": "resource_entries",
            "type": "array",
            "items": {
              "$ref": "#/definitions/entities/resource_entry"
            }
          },
          "graphql_queries": {
            "description": "graphql_queries",
            "type": "array",
            "items": {
              "$ref": "#/definitions/entities/graphql_query"
            }
          }
        }
      },
      "resource_entry": {
        "description": "resource_entry",
        "type": "object",
        "required": [
          "resource_name"
        ],
        "properties": {
          "resource_name": {
            "description": "The resource_name of this resource_entry.",
            "type": "string"
          }
        }
      },
      "rest_resource": {
        "description": "rest_resource",
        "type": "object",
        "required": [
          "operations",
          "name"
        ],
        "properties": {
          "name": {
            "description": "The name of this rest_resource.",
            "type": "string"
          },
          "identifier": {
            "allOf": [{
            "description": "The identifier of this rest_resource.",
            "type": "string"
            }, {
            "$ref": "#/definitions/value_domain_types/identifier"
            }]
          },
          "namespace": {
            "allOf": [{
            "description": "The namespace of this rest_resource.",
            "type": "string"
            }, {
            "$ref": "#/definitions/value_domain_types/namespace"
            }]
          },
          "path": {
            "description": "The path of this rest_resource.",
            "type": "string"
          },
          "description": {
            "description": "The description of this rest_resource.",
            "type": "string"
          },
          "operations": {
            "description": "operations",
            "type": "array",
            "items": {
              "$ref": "#/definitions/entities/rest_operation"
            }
          }
        }
      },
      "data_access": {
        "description": "data_access",
        "type": "object",
        "required": [
          "entity_name",
          "name",
          "script_type",
          "script_body"
        ],
        "properties": {
          "entity_name": {
            "description": "The entity_name of this data_access.",
            "type": "string"
          },
          "cardinality": {
            "description": "The cardinality of this data_access.",
            "type": "string"
          },
          "multiple": {
            "description": "Defines this data_access is multiple or not.",
            "type": "boolean"
          },
          "type": {
            "description": "The type of this data_access.",
            "type": "string"
          },
          "name": {
            "description": "The name of this data_access.",
            "type": "string"
          },
          "identifier": {
            "allOf": [{
            "description": "The identifier of this data_access.",
            "type": "string"
            }, {
            "$ref": "#/definitions/value_domain_types/identifier"
            }]
          },
          "description": {
            "description": "The description of this data_access.",
            "type": "string"
          },
          "script_type": {
            "description": "The script_type of this data_access.",
            "enum":[
              "jooq-kotlin",
              "jooq-java",
              "mirage-sql"
            ],
            "type": "string"
          },
          "script_body": {
            "description": "The script_body of this data_access.",
            "type": "string"
          }
        }
      },
      "entity": {
        "description": "エンティティ",
        "type": "object",
        "required": [
          "properties",
          "name"
        ],
        "properties": {
          "name": {
            "description": "名称",
            "type": "string"
          },
          "namespace": {
            "allOf": [{
            "description": "名前空間",
            "type": "string"
            }, {
            "$ref": "#/definitions/value_domain_types/namespace"
            }]
          },
          "identifier": {
            "allOf": [{
            "description": "識別子 省略時は名称を使用",
            "type": "string"
            }, {
            "$ref": "#/definitions/value_domain_types/identifier"
            }]
          },
          "description": {
            "description": "詳細",
            "type": "string"
          },
          "value_object": {
            "description": "値オブジェクトかどうか",
            "type": "boolean"
          },
          "properties": {
            "description": "このエンティティのプロパティ",
            "type": "array",
            "items": {
              "$ref": "#/definitions/entities/property"
            }
          },
          "relationships": {
            "description": "このエンティティと他のエンティティの関連",
            "type": "array",
            "items": {
              "$ref": "#/definitions/entities/relationship"
            }
          },
          "queries": {
            "description": "このエンティティに対するルートクエリ",
            "type": "array",
            "items": {
              "$ref": "#/definitions/entities/query"
            }
          }
        }
      },
      "named_param": {
        "description": "named_param",
        "type": "object",
        "required": [
          "name",
          "type"
        ],
        "properties": {
          "name": {
            "description": "The name of this named_param.",
            "type": "string"
          },
          "type": {
            "description": "The type of this named_param.",
            "type": "string"
          },
          "description": {
            "description": "The description of this named_param.",
            "type": "string"
          }
        }
      },
      "named_value": {
        "description": "named_value",
        "type": "object",
        "required": [
          "name",
          "expression"
        ],
        "properties": {
          "name": {
            "description": "The name of this named_value.",
            "type": "string"
          },
          "expression": {
            "description": "The expression of this named_value.",
            "type": "string"
          }
        }
      },
      "property": {
        "description": "property",
        "type": "object",
        "required": [
          "name",
          "type"
        ],
        "properties": {
          "name": {
            "description": "The name of this property.",
            "type": "string"
          },
          "identifier": {
            "allOf": [{
            "description": "The identifier of this property.",
            "type": "string"
            }, {
            "$ref": "#/definitions/value_domain_types/identifier"
            }]
          },
          "primary_key": {
            "description": "Defines this property is primary_key or not.",
            "type": "boolean"
          },
          "type": {
            "allOf": [{
            "description": "The type of this property.",
            "type": "string"
            }, {
            "$ref": "#/definitions/value_domain_types/base_type"
            }]
          },
          "domain_type_name": {
            "description": "制約型名",
            "type": "string"
          },
          "size": {
            "description": "the maximum allowed size of this property",
            "type": "number"
          },
          "optional": {
            "description": "Defines this property is optional or not.",
            "type": "boolean"
          },
          "description": {
            "description": "The description of this property.",
            "type": "string"
          },
          "default_value": {
            "description": "デフォルト値",
            "type": "string"
          },
          "example_value": {
            "description": "The example_value of this property.",
            "type": "string"
          },
          "table_column_name": {
            "description": "The table_column_name of this property.",
            "type": "string"
          },
          "snippet": {
            "description": "The snippet of this property.",
            "type": "string"
          },
          "multiple": {
            "description": "Defines this property is multiple or not.",
            "type": "boolean"
          },
          "domain": {
            "description": "domain",
            "$ref": "#/definitions/entities/value_domain"
          }
        }
      },
      "property_mapping": {
        "description": "property_mapping",
        "type": "object",
        "required": [
          "from",
          "to"
        ],
        "properties": {
          "from": {
            "description": "The from of this property_mapping.",
            "type": "string"
          },
          "to": {
            "description": "The to of this property_mapping.",
            "type": "string"
          },
          "null_value": {
            "description": "The null_value of this property_mapping.",
            "type": "string"
          }
        }
      },
      "query": {
        "description": "The queries from which all navigation originates.",
        "type": "object",
        "required": [
          "name",
          "snippet"
        ],
        "properties": {
          "name": {
            "description": "クエリ名称",
            "type": "string"
          },
          "identifier": {
            "allOf": [{
            "description": "識別子",
            "type": "string"
            }, {
            "$ref": "#/definitions/value_domain_types/identifier"
            }]
          },
          "type": {
            "description": "結果型",
            "type": "string"
          },
          "result_entity_name": {
            "description": "クエリ結果エンティティ名",
            "type": "string"
          },
          "description": {
            "description": "詳細",
            "type": "string"
          },
          "cardinality": {
            "description": "多重度",
            "type": "string"
          },
          "snippet": {
            "description": "クエリスクリプト",
            "type": "string"
          }
        }
      },
      "relationship": {
        "description": "relationship",
        "type": "object",
        "required": [
          "name",
          "cardinality",
          "reference_entity_name"
        ],
        "properties": {
          "name": {
            "description": "The name of this relationship.",
            "type": "string"
          },
          "identifier": {
            "allOf": [{
            "description": "The identifier of this relationship.",
            "type": "string"
            }, {
            "$ref": "#/definitions/value_domain_types/identifier"
            }]
          },
          "cardinality": {
            "description": "The cardinality of this relationship.",
            "enum":[
              "1",
              "0..1",
              "*",
              "1..*"
            ],
            "type": "string"
          },
          "reference_entity_name": {
            "description": "The reference_entity_name of this relationship.",
            "type": "string"
          },
          "aggregate": {
            "description": "Defines this relationship is aggregate or not.",
            "type": "boolean"
          },
          "inherited": {
            "description": "Defines this relationship is inherited or not.",
            "type": "boolean"
          },
          "description": {
            "description": "The description of this relationship.",
            "type": "string"
          },
          "snippet": {
            "description": "The snippet of this relationship.",
            "type": "string"
          },
          "mappings": {
            "description": "mappings",
            "type": "array",
            "items": {
              "$ref": "#/definitions/entities/property_mapping"
            }
          }
        }
      },
      "value_domain_type": {
        "description": "value_domain_type",
        "type": "object",
        "required": [
          "domain",
          "name",
          "type"
        ],
        "properties": {
          "name": {
            "description": "The name of this value_domain_type.",
            "type": "string"
          },
          "type": {
            "allOf": [{
            "description": "The type of this value_domain_type.",
            "type": "string"
            }, {
            "$ref": "#/definitions/value_domain_types/base_type"
            }]
          },
          "description": {
            "description": "The description of this value_domain_type.",
            "type": "string"
          },
          "domain": {
            "description": "domain",
            "$ref": "#/definitions/entities/value_domain"
          }
        }
      },
      "value_domain": {
        "description": "value_domain",
        "type": "object",
        "required": [
        ],
        "properties": {
          "pattern": {
            "description": "許容される値のパターン(正規表現)",
            "type": "string"
          },
          "choices": {
            "description": "許容される値のリスト",
            "type": "array",
            "items": {
              "$ref": "#/definitions/entities/value_item"
            }
          }
        }
      },
      "value_item": {
        "description": "value_item",
        "type": "object",
        "required": [
          "value"
        ],
        "properties": {
          "value": {
            "description": "The value of this value_item.",
            "type": "string"
          },
          "label": {
            "description": "The label of this value_item.",
            "type": "string"
          },
          "description": {
            "description": "The description of this value_item.",
            "type": "string"
          }
        }
      }
    }
  }
}