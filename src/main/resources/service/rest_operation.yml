entities:
  - name: rest_operation
    namespace: laplacian_arch.service_api_arch
    properties:
      - name: method
        type: string
        domain_type_name: http_method_for_rest

      - name: path
        type: string
        domain_type_name: url_path_with_placeholders
        optional: true
        default_value: |
          "/"

      - name: name
        type: string
        optional: true
        default_value: |
          identifier

      - name: identifier
        type: string
        optional: true
        default_value: |
          method.lowerUnderscorize() + "_" +
          if (path == "/") {
              resource.identifier.pluralize()
          }
          else {
              path.lowerUnderscorize()
          }

      - name: namespace
        type: string
        domain_type_name: namespace
        default_value: |
          "${resource.namespace}.$identifier"

      - name: description
        type: string
        optional: true
        default_value: |
          name

      - name: response_body_type
        type: string
        snippet: |
          responseBodyRoot?.dataType ?:
          ("{" + responseBody.joinToString(",\n"){ it.dataType } + "}")

    relationships:
      - name: resource
        cardinality: '1'
        reference_entity_name: rest_resource
        inherited: true

      - name: relating_entities
        cardinality: '*'
        reference_entity_name: entity
        snippet: |
          ( pathParameters +
            requestHeaders +
            queryParameters +
            requestBody +
            responseHeaders +
            responseBody
          )
          .flatMap{ it.relatingEntities }
          .distinct()

      - name: relating_top_level_entities
        cardinality: '*'
        reference_entity_name: entity
        snippet: |
          relatingEntities.filter{ it.topLevel }

      - name: path_parameters
        cardinality: '*'
        reference_entity_name: rest_data_item
        aggregate: true

      - name: request_headers
        cardinality: '*'
        reference_entity_name: rest_data_item
        aggregate: true

      - name: query_parameters
        cardinality: '*'
        reference_entity_name: rest_data_item
        aggregate: true

      - name: request_body
        cardinality: '*'
        reference_entity_name: rest_data_item
        aggregate: true

      - name: response_headers
        cardinality: '*'
        reference_entity_name: rest_data_item
        aggregate: true

      - name: response_body
        cardinality: '*'
        reference_entity_name: rest_data_item
        aggregate: true

      - name: response_body_root
        cardinality: '0..1'
        reference_entity_name: rest_data_item
        snippet: |
          responseBody.find{ it.root }
